<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>📚 Biblioteca Jurídica para Amigos</title>
<style>
html, body { height: 100%; margin:0; padding:0; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg,#f0f4f7,#d9e2ec);
    display: flex; flex-direction: column;
}

/* Login centrado verticalmente */
.login-container {
    background:white; padding:30px; border-radius:16px;
    box-shadow:0 8px 25px rgba(0,0,0,0.12);
    max-width:400px; width:90%;
    margin:auto; flex-grow:1; display:flex; flex-direction:column; justify-content:center;
}
h1,h2,h3 { text-align:center; color:#2c3e50; margin:0 0 15px 0; }
input { width:100%; padding:14px; margin:8px 0; border-radius:10px; border:1px solid #ccc; font-size:15px; }
button {
    padding:12px 18px; margin-top:10px; border:none; border-radius:10px;
    background:#3498db; color:white; cursor:pointer; font-weight:bold; transition:0.3s;
}
button:hover { background:#2980b9; }
.error { color:red; text-align:center; margin-top:10px; }
.hidden { display:none; }

/* App Container */
.app-container {
    background:white; padding:30px; border-radius:16px; 
    box-shadow:0 8px 25px rgba(0,0,0,0.12); max-width:950px; margin:40px auto 20px auto;
}

/* Barra superior */
.top-bar {
    position: sticky; top:0; background:white; z-index:100; 
    display:flex; justify-content:space-between; align-items:center; 
    padding:10px 20px; box-shadow:0 3px 10px rgba(0,0,0,0.1); border-radius:16px;
    margin-bottom:15px;
}
.top-bar input { flex:1; margin-right:10px; }

/* Grid libros */
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
.card {
    background:white; border-radius:16px; padding:20px; box-shadow:0 6px 20px rgba(0,0,0,0.08);
    transition:0.4s; display:flex; flex-direction:column; justify-content:space-between;
}
.card:hover { transform:translateY(-6px); box-shadow:0 12px 30px rgba(0,0,0,0.15); }
.card h3 { margin:10px 0 8px 0; font-size:16px; color:#2c3e50; font-weight:600; }
.card p { margin:0 0 15px 0; color:#555; font-size:14px; }
.card a {
    text-align:center; padding:10px 14px; background:#2ecc71; color:white; border-radius:10px;
    text-decoration:none; font-weight:bold; transition:0.3s;
}
.card a:hover { background:#27ae60; }

/* Panel admin */
.panel { background:#f0f4f7; padding:20px; border-radius:12px; margin-top:20px; }
.panel h3 { margin-top:0; color:#34495e; }

/* Footer */
.footer { text-align:center; margin-top:30px; font-size:14px; color:#555; line-height:1.6; }
.footer span { display:block; margin-top:6px; }

@media(max-width:600px){
    input { font-size:14px; padding:12px; }
    button { font-size:14px; padding:10px; }
    .card h3 { font-size:14px; }
    .card p { font-size:13px; }
    .login-container { padding:20px; }
}
</style>
</head>
<body>

<!-- Login -->
<div class="login-container" id="loginContainer">
    <h1>🔒 Iniciar Sesión</h1>
    <input type="text" id="usuario" placeholder="Usuario">
    <input type="password" id="contrasena" placeholder="Contraseña">
    <button onclick="login()">Ingresar</button>
    <div class="error" id="errorLogin"></div>
</div>

<!-- App -->
<div class="app-container hidden" id="appContainer">
    <h1>📚 Biblioteca Jurídica para Amigos</h1>

    <div class="top-bar">
        <input type="text" id="busqueda" placeholder="Buscar por autor o título..." onkeyup="buscar()">
        <button onclick="cerrarSesion()">🔓 Cerrar Sesión</button>
    </div>

    <!-- Panel admin (solo admin) -->
    <div id="adminPanel" class="panel hidden">
        <h3>Administración de Usuarios</h3>
        <input type="text" id="nuevoUsuario" placeholder="Nuevo usuario">
        <input type="password" id="nuevaContrasena" placeholder="Contraseña">
        <label><input type="checkbox" id="nuevoAdmin"> Admin</label>
        <button onclick="agregarUsuario()">Agregar Usuario</button>
        <div class="user-list" id="listaUsuarios"></div>
    </div>

    <div id="addBookPanel" class="panel hidden">
        <h3>Agregar Libro</h3>
        <input type="text" id="nuevoLibro" placeholder="Título del libro">
        <input type="text" id="nuevoAutor" placeholder="Autor">
        <input type="text" id="nuevoLink" placeholder="Link de Google Drive">
        <button onclick="agregarLibro()">Agregar Libro</button>
    </div>

    <!-- Tarjetas libros -->
    <div class="grid" id="tarjetasLibros"></div>
</div>

<!-- Footer -->
<div class="footer">
    Diseño de la página web por <strong>Jerry</strong> | Última actualización: <span id="fechaActualizacion">13 de agosto de 2025</span>
    <span>
        Agradecimientos a quienes hicieron posible esta biblioteca:
        <br>
        <strong style="color:#2c3e50; font-style:italic;">Fundadores:</strong> 
        <span style="color:#2980b9; font-weight:bold;">Lic. Miguel Ángel Sánchez Terrón</span> y 
        <span style="color:#2980b0; font-weight:bold;">Lic. Gerardo Edmundo Calzada Manjarrez</span>
        <br>
        <strong style="color:#2c3e50; font-style:italic;">Colaborador:</strong> 
        <span style="color:#27ae60; font-weight:bold;">Srita. Alondra Inés Ocaña Jiménez</span>
    </span>
</div>

<script>
// ----------------- Usuarios y sesión -----------------
let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [{usuario:"admin",contrasena:"1234",admin:true}];
localStorage.setItem('usuarios', JSON.stringify(usuarios));
let usuarioActual = JSON.parse(localStorage.getItem('usuarioActual')) || null;

// ----------------- Libros -----------------
let datos = [];
let librosGuardados = JSON.parse(localStorage.getItem('librosGuardados')) || [];

// Google Sheets
const SHEET_ID = "1GoqoMekRvl3WB07wt4jPbPjuPIQ61EA0Ao_pIGlbDn0";
const SHEET_NAME = "libros";
const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
window.google = { visualization: { Query: { setResponse: googleVisualizationQuerySetResponse } } };
const script = document.createElement("script"); script.src = URL; document.body.appendChild(script);

function googleVisualizationQuerySetResponse(response){
    const rows = response.table.rows;
    datos = rows.map(row=>({Libro: row.c[0]?.v||"", Autor: row.c[1]?.v||"", Link: row.c[2]?.v||""}));
    mostrarTarjetas(getTodosLosLibros());
}

function getTodosLosLibros(){ return [...datos, ...librosGuardados]; }

// ----------------- Funciones -----------------
function login(){
    const user = document.getElementById("usuario").value;
    const pass = document.getElementById("contrasena").value;
    const encontrado = usuarios.find(u=>u.usuario===user && u.contrasena===pass);
    if(encontrado){
        usuarioActual = encontrado;
        localStorage.setItem('usuarioActual', JSON.stringify(usuarioActual));
        document.getElementById("loginContainer").classList.add('hidden');
        document.getElementById("appContainer").classList.remove('hidden');

        if(encontrado.admin){
            document.getElementById("adminPanel").classList.remove('hidden');
            document.getElementById("addBookPanel").classList.remove('hidden');
        }

        mostrarTarjetas(getTodosLosLibros());
        mostrarUsuarios();
    } else { document.getElementById("errorLogin").innerText = "Usuario o contraseña incorrectos"; }
}

function cerrarSesion(){ 
    localStorage.removeItem('usuarioActual'); 
    usuarioActual=null; 
    document.getElementById("loginContainer").classList.remove('hidden'); 
    document.getElementById("appContainer").classList.add('hidden'); 
}

function buscar(){
    const texto = document.getElementById("busqueda").value.toLowerCase();
    mostrarTarjetas(getTodosLosLibros().filter(d=>d.Libro.toLowerCase().includes(texto)||d.Autor.toLowerCase().includes(texto)));
}

function mostrarTarjetas(filas){
    const cont = document.getElementById("tarjetasLibros");
    cont.innerHTML = "";
    filas.forEach(fila=>{
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<h3>${fila.Libro}</h3><p>${fila.Autor}</p><a href="${fila.Link}" target="_blank">Abrir</a>`;
        cont.appendChild(div);
    });
}

// Agregar libro
function agregarLibro(){
    const titulo=document.getElementById("nuevoLibro").value.trim();
    const autor=document.getElementById("nuevoAutor").value.trim();
    const link=document.getElementById("nuevoLink").value.trim();
    if(!titulo||!autor||!link){ alert("Completa todos los campos"); return; }
    librosGuardados.push({Libro:titulo,Autor:autor,Link:link});
    localStorage.setItem('librosGuardados', JSON.stringify(librosGuardados));
    document.getElementById("nuevoLibro").value=""; document.getElementById("nuevoAutor").value=""; document.getElementById("nuevoLink").value="";
    mostrarTarjetas(getTodosLosLibros());
}

// Admin usuarios
function mostrarUsuarios(){
    if(!usuarioActual || !usuarioActual.admin) return;
    const lista=document.getElementById("listaUsuarios"); lista.innerHTML="";
    usuarios.forEach(u=>{ 
        const div=document.createElement("div"); 
        div.innerHTML=`${u.usuario} ${u.admin?"(Admin)":""} <button onclick="eliminarUsuario('${u.usuario}')">Eliminar</button>`; 
        lista.appendChild(div); 
    });
}
function agregarUsuario(){
    const u=document.getElementById("nuevoUsuario").value.trim();
    const c=document.getElementById("nuevaContrasena").value.trim();
    const admin=document.getElementById("nuevoAdmin").checked;
    if(u && c){
        if(usuarios.find(x=>x.usuario===u)){alert("Usuario ya existe"); return;}
        usuarios.push({usuario:u,contrasena:c,admin:admin});
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        mostrarUsuarios();
        document.getElementById("nuevoUsuario").value=""; document.getElementById("nuevaContrasena").value=""; document.getElementById("nuevoAdmin").checked=false;
    }
}
function eliminarUsuario(usuario){
    if(usuarioActual.usuario===usuario){alert("No puedes eliminar tu propio usuario"); return;}
    usuarios = usuarios.filter(u=>u.usuario!==usuario); localStorage.setItem('usuarios', JSON.stringify(usuarios)); mostrarUsuarios();
}

// Inicialización
if(usuarioActual){
    document.getElementById("loginContainer").classList.add('hidden'); 
    document.getElementById("appContainer").classList.remove('hidden');

    if(usuarioActual.admin){
        document.getElementById("adminPanel").classList.remove('hidden');
        document.getElementById("addBookPanel").classList.remove('hidden');
    }

    mostrarUsuarios();
}
</script>
</body>
</html>
