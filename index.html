<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Libritos Jur√≠dicos</title>
  <meta name="description" content="Buscador simple de libros jur√≠dicos conectado a Google Sheets" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === Estilos principales === */
    :root{
      --bg:#0b1020;
      --card:#111833;
      --muted:#96a0be;
      --text:#e9ecf5;
      --accent:#7aa2ff;
      --accent-2:#b2c8ff;
      --ring:rgba(122,162,255,.35);
      --shadow: 0 10px 25px rgba(0,0,0,.25), 0 6px 12px rgba(20,40,120,.25);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(1000px 500px at 10% -10%, rgba(122,162,255,.08), transparent 60%),
                  radial-gradient(800px 400px at 110% 10%, rgba(178,200,255,.06), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    .container{max-width:1100px;margin:0 auto;padding:28px 16px 60px}
    .app-card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); box-shadow:var(--shadow);
      backdrop-filter: blur(6px);
    }
    header{display:flex; gap:16px; align-items:center; justify-content:space-between; padding:18px 20px 4px}
    h1{font-size: clamp(22px, 2.4vw, 28px); margin:0; letter-spacing:.2px}
    .subtitle{color:var(--muted); font-size:14px; margin-top:4px}
    .toolbar{display:grid; gap:12px; grid-template-columns:1fr; padding:16px}
    @media (min-width:720px){ .toolbar{grid-template-columns: 1fr 220px;} }
    .searchbox{position:relative}
    .searchbox input{
      width:100%; padding:14px 42px; border-radius:999px; border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, #0f1631, #0c122a);
      color:var(--text); font-size:16px; outline:none; transition: box-shadow .2s, border-color .2s;
    }
    .searchbox input:focus{ border-color: var(--accent); box-shadow:0 0 0 4px var(--ring); }
    .searchbox .icon{position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.7}
    .searchbox .clear{position:absolute; right:10px; top:50%; transform:translateY(-50%);
      border:none; background:transparent; color:var(--muted); cursor:pointer; font-size:18px}
    .segmented{display:inline-grid; grid-auto-flow:column; gap:6px; background:#0b1230; padding:6px; border-radius:999px; border:1px solid rgba(255,255,255,.08)}
    .segmented button{border:none; background:transparent; color:var(--muted); padding:8px 14px; border-radius:999px; cursor:pointer; font-weight:600}
    .segmented button[aria-pressed="true"]{background:linear-gradient(180deg,#1b2753,#13204a); color:var(--text);}
    .table-wrap{padding:10px 16px 20px}
    .table{width:100%; border-collapse:separate; border-spacing:0; border-radius:var(--radius); box-shadow:var(--shadow); background:var(--card);}
    .table th, .table td{padding:14px 16px; text-align:left}
    .table thead th{font-size:12px; letter-spacing:.4px; text-transform:uppercase; color:var(--accent-2); border-bottom:1px solid rgba(255,255,255,.08);}
    .table tbody tr:hover{background:linear-gradient(180deg, rgba(122,162,255,.06), rgba(122,162,255,.04))}
    .btn{border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; color:#0c1330; background:linear-gradient(180deg,#a7c0ff,#7aa2ff);}
    .btn:hover{filter:brightness(1.05)}
    .muted{color:var(--muted)}
    mark{background:rgba(255,238,0,.35); padding:0 2px; border-radius:4px}
    .footer{padding:18px 20px 26px; color:var(--muted); font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <div class="app-card">
      <header>
        <div>
          <h1>üìö Libritos Jur√≠dicos</h1>
          <div class="subtitle">Buscador conectado a Google Sheets (p√∫blico con enlace)</div>
        </div>
        <span class="badge" id="status">Cargando‚Ä¶</span>
      </header>

      <div class="toolbar">
        <div class="searchbox">
          <input id="q" type="text" placeholder="Buscar por t√≠tulo o autor‚Ä¶" autocomplete="off" />
          <button class="clear" id="clear">√ó</button>
        </div>
        <div class="filters">
          <div class="segmented">
            <button id="f-todo" class="segbtn" aria-pressed="true" data-field="todo">Todo</button>
            <button id="f-libro" class="segbtn" aria-pressed="false" data-field="libro">Libro</button>
            <button id="f-autor" class="segbtn" aria-pressed="false" data-field="autor">Autor</button>
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" id="results">
          <thead>
            <tr>
              <th>Libro</th>
              <th>Autor</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <!-- filas din√°micas -->
          </tbody>
        </table>
      </div>

      <div class="footer">
        Consejo: comparte tu Google Sheet como ‚ÄúCualquiera con el enlace: Lector‚Äù y publ√≠calo en la web.
      </div>
    </div>
  </div>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/1GoqoMekRvl3WB07wt4jPbPjuPIQ61EA0Ao_pIGlbDn0/gviz/tq?tqx=out:csv&sheet=libros";

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function escapeHtml(str){
      return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
    }
    function highlight(text, query){
      if(!query) return escapeHtml(text);
      const re = new RegExp(`(${query})`, 'ig');
      return escapeHtml(text).replace(re, '<mark>$1</mark>');
    }

    async function fetchSheet(url){
      const res = await fetch(url);
      const text = await res.text();
      const lines = text.split(/\r?\n/).filter(l => l.trim());
      const delimiter = lines[0].includes(";") ? ";" : ",";
      const headers = lines.shift().split(delimiter).map(h => h.trim().toLowerCase());
      const rows = lines.map(line => {
  const cols = line.split(delimiter);
  return {
    libro: cols[idxLibro]?.trim() || "",
    autor: cols[idxAutor]?.trim() || "",
    link:  cols[idxLink]?.trim()  || ""
  };
});

      const idxLibro = headers.indexOf("libro");
      const idxAutor = headers.indexOf("autor");
      const idxLink  = headers.indexOf("link");
      if(idxLibro===-1 || idxAutor===-1 || idxLink===-1){
        throw new Error('Encabezados requeridos no encontrados');
      }
      return lines.map(line=>{
        const cols = line.split(",");
        return {libro:cols[idxLibro]||"", autor:cols[idxAutor]||"", link:cols[idxLink]||""};
      });
    }

    function renderRows(data, query="", field="todo"){
      const tbody = $('#tbody');
      const q = query.toLowerCase();
      const filtered = data.filter(({libro, autor})=>{
        if(!q) return true;
        const inLibro = libro.toLowerCase().includes(q);
        const inAutor = autor.toLowerCase().includes(q);
        if(field==="libro") return inLibro;
        if(field==="autor") return inAutor;
        return inLibro||inAutor;
      });
      tbody.innerHTML = filtered.map(({libro,autor,link})=>`
        <tr>
          <td>${highlight(libro,q)}</td>
          <td>${highlight(autor,q)}</td>
          <td><a class="btn" href="${link}" target="_blank">Abrir</a></td>
        </tr>
      `).join("");
      $('#status').textContent = `${filtered.length} resultados`;
    }

    let DATA = [];
    let currentField="todo";

    async function init(){
      try{
        DATA = await fetchSheet(SHEET_URL);
        renderRows(DATA);
      }catch(e){
        $('#status').textContent="Error al cargar";
        $('#tbody').innerHTML = `<tr><td colspan="3">${escapeHtml(e.message)}</td></tr>`;
      }
    }

    $('#q').addEventListener("input", e=>renderRows(DATA,e.target.value,currentField));
    $('#clear').addEventListener("click", ()=>{ $('#q').value=""; renderRows(DATA,"",currentField); });
    $$('.segbtn').forEach(btn=>{
      btn.addEventListener("click",()=>{
        $$('.segbtn').forEach(b=>b.setAttribute("aria-pressed","false"));
        btn.setAttribute("aria-pressed","true");
        currentField=btn.dataset.field;
        renderRows(DATA,$('#q').value,currentField);
      });
    });

    init();
  </script>
</body>
</html>
