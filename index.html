<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Biblioteca Jurídica</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .btn { padding: 8px 12px; margin: 5px; border: none; cursor: pointer; border-radius: 6px; }
    .btn-green { background-color: #28a745; color: white; }
    .btn-red { background-color: #dc3545; color: white; }
    .btn-blue { background-color: #007bff; color: white; }
    input { padding: 6px; margin: 4px; border-radius: 4px; border: 1px solid #ccc; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>

  <h2>Ingreso al sistema</h2>
  <div id="loginSection">
    <input type="text" id="username" placeholder="Usuario"><br>
    <input type="password" id="password" placeholder="Contraseña"><br>
    <button class="btn btn-blue" onclick="login()">Ingresar</button>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>Panel de Administración</h2>
    <button class="btn btn-blue" onclick="logout()">Cerrar Sesión</button>

    <h3>Agregar Usuario</h3>
    <input type="text" id="newUser" placeholder="Usuario">
    <input type="password" id="newPass" placeholder="Contraseña">
    <select id="newAdmin">
      <option value="no">Usuario</option>
      <option value="si">Admin</option>
    </select>
    <button class="btn btn-green" onclick="addUser()">Agregar</button>

    <h3>Lista de Usuarios</h3>
    <table id="userTable">
      <thead>
        <tr><th>Usuario</th><th>Admin</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxjaE86PhhFo3glD_r7Eo41b-OwydA4un_hnXPE03MamVPvk86u3Rt5keI7gTJYFUnoGw/exec"; 
let currentUser = null;

// 📌 Login
async function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;

  const res = await fetch(WEB_APP_URL);
  const users = await res.json();

  const found = users.find(u => u.user === user && u.pass === pass);
  if(found){
    currentUser = found;
    document.getElementById("loginSection").classList.add("hidden");
    if(found.admin === "si"){
      document.getElementById("adminPanel").classList.remove("hidden");
      loadUsers();
    } else {
      alert("Bienvenido usuario: " + found.user);
    }
  } else {
    alert("Usuario o contraseña incorrectos");
  }
}

// 📌 Cerrar sesión
function logout(){
  currentUser = null;
  document.getElementById("loginSection").classList.remove("hidden");
  document.getElementById("adminPanel").classList.add("hidden");
}

// 📌 Cargar lista de usuarios
async function loadUsers() {
  const res = await fetch(WEB_APP_URL);
  const users = await res.json();
  const tbody = document.querySelector("#userTable tbody");
  tbody.innerHTML = "";
  users.forEach(u => {
    const row = `<tr>
      <td>${u.user}</td>
      <td>${u.admin}</td>
      <td><button class="btn btn-red" onclick="deleteUser('${u.user}')">Eliminar</button></td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

// 📌 Agregar usuario
async function addUser() {
  const user = document.getElementById("newUser").value;
  const pass = document.getElementById("newPass").value;
  const admin = document.getElementById("newAdmin").value;

  const res = await fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({ action: "add", user, pass, admin })
  });
  const result = await res.json();
  alert(result.message);
  loadUsers();
}

// 📌 Eliminar usuario
async function deleteUser(user) {
  if(confirm("¿Seguro que deseas eliminar a " + user + "?")){
    const res = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify({ action: "delete", user })
    });
    const result = await res.json();
    alert(result.message);
    loadUsers();
  }
}
</script>
</body>
</html>
